We provide the code `semantic_pipeline/` to get the semantic segmentation results using the RAM++ and Grounded-SAM. 
You can also directly use segmentation masks provided in Google drive link: https://drive.google.com/drive/folders/141lQdHufOMp3ovRSQsV_06HDgxwhTKuF?usp=sharing

### 0. Install the dependencies
```bash
conda create -n ram-sam python=3.10

# install pytorch and torchvision
conda install pytorch==2.5.1 torchvision==0.20.1 pytorch-cuda=12.1 -c pytorch -c nvidia

# install sam2
git clone https://github.com/SysCV/sam-hq.git
cd sam-hq/sam-hq2
pip install -e .

# install ground-dino
git clone https://github.com/IDEA-Research/GroundingDINO.git
cd GroundingDINO/
export TORCH_CUDA_ARCH_LIST="9.0" # adjust this according to your GPU
pip install -e .

# if you encounter the error 'NameError: name '_C' is not defined'
# you can check library using following command
ldd groundingdino/_C.cpython-311-x86_64-linux-gnu.so

# another reason for the error is your gcc version is too high, it will result 'libstdc++.so.6: version `GLIBCXX_3.4.32' not found '
# you can use following command to update your gcc lib

# install ram++
git clone https://github.com/xinyu1205/recognize-anything.git
cd recognize-anything
pip install -e .
```

### 1. Download the pretrained model
```bash
mkdir pretrain_models
wget https://huggingface.co/xinyu1205/recognize-anything-plus-model/blob/main/ram_plus_swin_large_14m.pth
wget https://github.com/IDEA-Research/GroundingDINO/releases/download/v0.1.0-alpha2/groundingdino_swinb_cogcoor.pth

# download the SAM2.1 HQ model
https://huggingface.co/lkeab/hq-sam/resolve/main/sam2.1_hq_hiera_large.pt?download=true
```

### 2. Generate the Tag Description for RAM++
```bash

# please set the azure openai config by environment variables
export OPENAI_API_KEY=YOUR_AZURE_OPENAI_KEY
export OPENAI_API_BASE=YOUR_AZURE_OPENAI_BASE
export OPENAI_DEPLOYMENT_NAME=YOUR_AZURE_OPENAI_DEPLOYMENT_NAME
export OPENAI_API_VERSION=YOUR_AZURE_OPENAI_API_VERSION

# you can reference `data/689fec23d7_dictionary.txt` for text file format
# generate the tag description for RAM++, this will output the tag description for each object
python generate_tag_des.py --text_file xxxx.txt
```

### 3. Generate the Semantic BBOX
```bash
# des file is the tag description file generated by the previous step
# your also need to prepare the txt file for the object id and object name mapping with the format `object_id object_name`, and its name should be `xxx_index.txt`
# please reference `data/689fec23d7_index.txt` for the format
python ram_ground_sam_openset.py --des_file xxx.json --image-dir xxx --output-dir xxx
```